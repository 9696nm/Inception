[www]
; ============================================================================
; PHP-FPM プール設定ファイル
; ============================================================================
; PHP-FPM の www プール設定
; Docker 環境で動作するように最適化
; ============================================================================

; ----------------------------------------------------------------------------
; ユーザーとグループ設定
; ----------------------------------------------------------------------------

; PHP-FPM を実行するユーザー
user = www-data

; PHP-FPM を実行するグループ
group = www-data

; ----------------------------------------------------------------------------
; リスニング設定
; ----------------------------------------------------------------------------

; PHP-FPM がリッスンするアドレスとポート
; 0.0.0.0:9000 で全てのネットワークインターフェースからの接続を許可
; Docker コンテナ間通信のために必要
listen = 0.0.0.0:9000

; リスニングソケットの所有者
listen.owner = www-data

; リスニングソケットのグループ
listen.group = www-data

; リスニングソケットのパーミッション
listen.mode = 0660

; ----------------------------------------------------------------------------
; プロセス管理設定
; ----------------------------------------------------------------------------

; プロセス管理方式
; dynamic: 動的にプロセス数を調整
pm = dynamic

; 最大子プロセス数
pm.max_children = 5

; 起動時の子プロセス数
pm.start_servers = 2

; アイドル状態の最小子プロセス数
pm.min_spare_servers = 1

; アイドル状態の最大子プロセス数
pm.max_spare_servers = 3

; 各子プロセスが処理するリクエスト数（メモリリーク対策）
pm.max_requests = 500

; ----------------------------------------------------------------------------
; ログ設定
; ----------------------------------------------------------------------------

; PHP エラーをキャッチ
catch_workers_output = yes

; アクセスログ形式
access.log = /proc/self/fd/2

; スローログ（デバッグ用）
; slowlog = /var/log/php-fpm-slow.log
; request_slowlog_timeout = 5s

; ----------------------------------------------------------------------------
; セキュリティ設定
; ----------------------------------------------------------------------------

; 環境変数をクリア（セキュリティ）
clear_env = no

; ----------------------------------------------------------------------------
; PHP 設定の上書き
; ----------------------------------------------------------------------------

; アップロードファイルの最大サイズ
php_admin_value[upload_max_filesize] = 64M

; POST データの最大サイズ
php_admin_value[post_max_size] = 64M

; メモリ制限
php_admin_value[memory_limit] = 256M

; 最大実行時間
php_admin_value[max_execution_time] = 300

; エラーログの出力先
php_admin_value[error_log] = /proc/self/fd/2

; エラー表示（開発環境では on、本番環境では off）
php_admin_flag[display_errors] = off
php_admin_flag[log_errors] = on

